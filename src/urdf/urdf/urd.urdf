<?xml version="1.0"?>
<robot name="urdf">
    
    <link name="base_footprint">
        <visual>
           <geometry>
                <box size="0.0 0.0 0.0"/>
           </geometry> 
           <material name="Blue">
                <color rgba="0.0 0.0 1.0 1"/>
           </material>
        </visual>
    </link>

    <link name="base_link">
        <visual>
           <geometry>
                <box size="0.65 0.5 0.3"/>
           </geometry> 
           <material name="Blue">
                <color rgba="0.0 0.0 1.0 1"/>
           </material>
        </visual>

        <collision>
            <geometry>
                <box size="0.65 0.5 0.3"/>
            </geometry>
        </collision>

        <inertial>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>    
            <mass value="1"/>
            <inertia ixx="0.028333333" ixy="0.0" ixz="0.0" iyy="0.042708333" iyz="0.0" izz="0.056041667"/>
        </inertial>
    </link>

    <joint name="base_joint" type="fixed">
        <axis xyz="0.0 0.0 0.0"/>
        <parent link="base_footprint"/>
        <child link="base_link"/>
        <origin xyz="0.0 0.0 0.25" rpy="0.0 0.0 0.0"/>
    </joint>

    
<!--left motor-->
    <link name="left_motor">
        <visual>
            <geometry>
                <cylinder radius="0.1" length="0.1"/>
            </geometry>
            <material name="Black">
                <color rgba="0.0 1 0.0 1"/>
            </material>
        </visual>

         <collision>  
            <geometry>
                <cylinder radius="0.1" length="0.1"/>
            </geometry> 
       
        </collision>

        <inertial>
            <mass value="1"/>
            <inertia ixx="0.003333333" ixy="0.0" ixz="0.0" iyy="0.003333333" iyz="0.0" izz="0.005"/>
        </inertial>
    </link>

    <joint name="left_motor_joint" type="continuous">
        <axis xyz="0.0 0.0 1"/>
        <parent link="base_link"/>
        <child link="left_motor"/>
 
        <origin xyz="-0.15 0.19 -0.15" rpy="-1.5708 0.0 0.0"/>    
    </joint>



<!--right motor-->
    <link name="right_motor">
        <visual>
            <geometry>
                <cylinder radius="0.1" length="0.1"/>
            </geometry>
            <material name="Green">
                <color rgba="0.0 1 0.0 1"/>
            </material>
        </visual>

        <collision>
            <geometry>
                <cylinder radius="0.1" length="0.1"/>
            </geometry> 
           
        </collision>

        <inertial>
            <mass value="1"/>
            <inertia ixx="0.003333333" ixy="0.0" ixz="0.0" iyy="0.003333333" iyz="0.0" izz="0.005"/>
        </inertial>
    </link>

    <joint name="right_motor_joint" type="continuous">
        <axis xyz="0.0 0.0 1"/>
        <parent link="base_link"/>
        <child link="right_motor"/>
        
        <origin xyz="-0.15 -0.19 -0.15" rpy="-1.5708 0.0 0.0"/>    
    </joint>



  <!--wheel-->
    <link name="caster_wheel">
        <visual>
            <geometry>
                <box size="0.1 0.1 0.05"/>
            </geometry>
            <material name="Green">
                <color rgba="0.0 1 0.0 1"/>
            </material>
        </visual>

        <collision>  
            <geometry>
                <box size="0.1 0.1 0.05"/>
            </geometry>    
        </collision>

        <inertial>
            <mass value="1"/>
            <inertia ixx="0.001041667" ixy="0.0" ixz="0.0" iyy="0.001041667" iyz="0.0" izz="0.001666667"/>
        </inertial>  
    </link>

    <joint name="caster_wheel_joint" type="continuous">
        <axis xyz="0.0 0.0 1"/>
        <parent link="base_link"/>
        <child link="caster_wheel"/>
        <origin xyz="0.2 0.0 -0.15" rpy="0.0 0.0 0.0"/>   
    </joint>


    <link name="wheel">
    <visual>  
        <geometry>
            <cylinder radius="0.05" length="0.05"/>
        </geometry>
        <material name="Red">
            <color rgba="1.0 0.0 0.0 1"/>
        </material>
    </visual>

    <collision>  
        <geometry>
            <cylinder radius="0.05" length="0.05"/>
        </geometry>
    </collision>

    <inertial>
        <mass value="1"/>
        <inertia ixx="0.000833333" ixy="0.0" ixz="0.0" iyy="0.000833333" iyz="0.0" izz="0.00125"/>
    </inertial>
    </link>

    <joint name="wheel_joint" type="continuous">
        <axis xyz="0.0 0.0 1"/>
        <parent link="caster_wheel"/>
        <child link="wheel"/>
       
        <origin xyz="0.0 0.0 -0.05" rpy="1.5708 0.0 0.0"/>   
    </joint>






<!--imu-->
    <link name="imu_link">
        <visual>
            <geometry>
                <cylinder radius="0.05" length="0.03"/>
            </geometry>

            <material name="">
                <color rgba="0.0 0.0 0.0 1"/>
            </material>
        </visual>

        <collision>
            <geometry>
                <cylinder radius="0.05" length="0.03"/>
            </geometry>
        </collision>

        <inertial>
            <mass value="0.03"/>
            <inertia ixx="0.000021" ixy="0.0" ixz="0.000021" iyy="0.0" iyz="0.0" izz="0.0000375"/>
        </inertial>
    </link>

    <joint name="imu_joint" type="fixed">
        <axis xyz="0.0 0.0 0.0"/>
        <parent link="base_link"/>
        <child link="imu_link"/>
        <limit lower="0.0" upper="0.0" effort="0.0" velocity="0.0"/>
        <origin xyz="0.0 0.0 0.16" rpy="0.0 0.0 0.0"/>
    </joint>



    <!--base_laser-->
    <link name="base_laser">
        <visual>
            <geometry>
                <box size="0.05 0.05 0.03"/>
            </geometry>

            <material name="Red">
                <color rgba="1 0.0 0.0 1"/>
            </material> 
        </visual>

        <collision>
            <geometry>
                <box size="0.05 0.05 0.03"/>
            </geometry>
        </collision>

        <inertial>
            <mass value="0.03"/>
           <inertia ixx="0.0" ixy="0.0" ixz="0.0" iyy="0.0" iyz="0.0" izz="0.0"/>
        </inertial>
    </link>

    <joint name="base_laser_joint" type="fixed">
        <axis xyz="0.0 0.0 0.0"/>
        <parent link="base_link"/>
        <child link="base_laser"/>
        <limit lower="0.0" upper="0.0" effort="0.0" velocity="0.0"/>
        <origin xyz="0.24 0.0 0.15" rpy="0.0 0.0 0.0"/>
        
    </joint>

    <!--laser-->
    <link name="laser">
        <visual>
            <geometry>
                <cylinder radius="0.05" length="0.03"/>
            </geometry>

            <material name="Green">
                <color rgba="0.0 1 0.0 1"/>
            </material> 
        </visual>

        <collision>
            <geometry>
                <cylinder radius="0.05" length="0.03"/>
            </geometry>
        </collision>

        <inertial>
            <mass value="0.03"/>
           <inertia ixx="0.000021" ixy="0.0" ixz="0.0" iyy="0.000021" iyz="0.0" izz="0.0000375"/>
        </inertial>
    </link>

    <joint name="laser_joint" type="fixed">
        <axis xyz="0.0 1 0.0"/>
        <parent link="base_laser"/>
        <child link="laser"/>
        <origin xyz="0.0 0.0 0.02" rpy="0.0 0.0 0.0"/>
    </joint>



    <!--camera-->
    <link name="camera_link">
        <visual>
            <geometry>
                <box size="0.05 0.1 0.03"/>
            </geometry>
            <material name="Green">
                <color rgba="0.0 1 0.0 1"/>
            </material>
        </visual>

        <collision>  
            <geometry>
                <box size="0.05 0.1 0.03"/>
            </geometry>
        </collision>

        <inertial>
            <mass value="0.03"/>
            <inertia ixx="0.00002725" ixy="0.0" ixz="0.0" iyy="0.00002725" iyz="0.0" izz="0.00003125"/>
        </inertial>  
    </link>

    <joint name="camera_joint" type="fixed">
        <axis xyz="0.0 0.0 0.0"/>
        <parent link="base_link"/>
        <child link="camera_link"/>
        <limit effort="10.0" velocity="10.0"/>
        <origin xyz="0.32 0.0 0.08"  rpy="0.0 0.0 0.0"/>   
    </joint>




<!--camera plugin -->
  <gazebo reference="camera_link">
    <sensor type="camera" name="camera">
      <update_rate>30.0</update_rate>
      <camera name="head">
        <horizontal_fov>1.3962634</horizontal_fov>
        <image>
          <width>800</width>
          <height>800</height>
          <format>R8G8B8</format>
        </image>
        <clip>
          <near>0.02</near>
          <far>300</far>
        </clip>
        <noise>
            <type>gaussian</type>
            <mean>0.0</mean>
            <stddev>0.007</stddev>
        </noise>
      </camera>
      <plugin name="camera_controller" filename="libgazebo_ros_camera.so">
        <alwaysOn>true</alwaysOn>
        <updateRate>0.0</updateRate>
        <cameraName>camera</cameraName>
        <imageTopicName>image_raw</imageTopicName>
        <cameraInfoTopicName>camera_info</cameraInfoTopicName>
        <frameName>camera_link</frameName>
        <hackBaseline>0.07</hackBaseline>
        <distortionK1>0.0</distortionK1>
        <distortionK2>0.0</distortionK2>
        <distortionK3>0.0</distortionK3>
        <distortionT1>0.0</distortionT1>
        <distortionT2>0.0</distortionT2>
      </plugin>
    </sensor>
  </gazebo>  


  <!-- imu plugin-->
  <gazebo reference="imu_link">
    <gravity>true</gravity>
    <sensor name="imu_sensor" type="imu">
      <always_on>true</always_on>
      <update_rate>100</update_rate>
      <visualize>true</visualize>
      <topic>__default_topic__</topic>
    
      <plugin filename="libgazebo_ros_imu_sensor.so" name="imu_plugin">
        <topicName>imu</topicName>
        <bodyName>imu_link</bodyName>
        <updateRateHZ>10.0</updateRateHZ>
        <gaussianNoise>0.0</gaussianNoise>
        <xyzOffset>0 0 0</xyzOffset>
        <rpyOffset>0 0 0</rpyOffset>
        <frameName>imu_link</frameName>
        <initialOrientationAsReference>false</initialOrientationAsReference>
      </plugin>
      <pose>0 0 0 0 0 0</pose>
    </sensor>
  </gazebo>


    <!-- laser plugin -->
    <gazebo reference="laser">
        <sensor type="ray" name="laser">
            <pose>0 0 0 0 0 0</pose>
            <visualize>true</visualize>
            <update_rate>20</update_rate>
            <ray>
                <scan>
                    <horizontal>
                        <samples>720</samples>
                        <resolution>1</resolution>
                        <min_angle>-2.3561944902</min_angle>
                        <max_angle>2.3561944902</max_angle>
                    </horizontal>
                </scan>
                <range>
                    <min>0.2</min>
                    <max>30</max>
                    <resolution>0.1</resolution>
                </range>
            </ray>
            <plugin name="Lidar" filename="libgazebo_ros_laser.so">
                <topicName>scan</topicName>
               <!-- <output_type>sensor_msgs/PointCloud2</output_type>-->
                <frameName>laser</frameName>
            </plugin>
        </sensor>
    </gazebo>



<!--motor driver plugin-->
    <gazebo>
        <plugin name="robot_controller"   filename="libgazebo_ros_diff_drive.so">
    <!-- Plugin update rate in Hz -->
            <updateRate>30</updateRate>

    <!-- Name of left joint, defaults to `left_joint` -->
            <leftJoint>left_motor_joint</leftJoint>

    <!-- Name of right joint, defaults to `right_joint` -->
            <rightJoint>right_motor_joint</rightJoint>

    <!-- The distance from the center of one wheel to the other, in meters, defaults to 0.34 m -->
    <!-- ระยะห่างล้อ y left - y right-->
            <wheelSeparation>0.38</wheelSeparation>

    <!-- Diameter of the wheels, in meters, defaults to 0.15 m -->
     <!-- เส้นผ่าศูนย์กลางr*2 -->
            <wheelDiameter>0.2</wheelDiameter>

    <!-- Wheel acceleration, in rad/s^2, defaults to 0.0 rad/s^2 -->
            <wheelAcceleration>1.0</wheelAcceleration>

    <!-- Maximum torque which the wheels can produce, in Nm, defaults to 5 Nm -->
            <wheelTorque>20</wheelTorque>

    <!-- Topic to receive geometry_msgs/Twist message commands, defaults to `cmd_vel` -->
    <!-- ใช้ cmd_vel เป็นTopicควบคุมหุ่นยนต์ ส่งค่าความเร็วเชิงเส้นเชิงมุมให้หุ่น -->
            <commandTopic>cmd_vel</commandTopic>

    <!-- Topic to publish nav_msgs/Odometry messages, defaults to `odom` -->
            <odometryTopic>odom</odometryTopic>

    <!-- Odometry frame, defaults to `odom` -->
            <odometryFrame>odom</odometryFrame>

    <!-- Robot frame to calculate odometry from, defaults to `base_footprint` -->
            <robotBaseFrame>base_footprint</robotBaseFrame>

    <!-- Odometry source, 0 for ENCODER, 1 for WORLD, defaults to WORLD -->
            <odometrySource>world</odometrySource>

    <!-- Set to true to publish transforms for the wheel links, defaults to false -->
            <publishWheelTF>false</publishWheelTF>

    <!-- Set to true to publish transforms for the odometry, defaults to true -->
            <publishOdom>true</publishOdom>


            <publishWheelJointState>true</publishWheelJointState>
    <!-- Set to true to swap right and left wheels, defaults to true -->
            <legacyMode>false</legacyMode>
             <publishTf>true</publishTf>
            <rosDebugLevel>na</rosDebugLevel>
            <publishOdomTF>true</publishOdomTF>
        </plugin>
   </gazebo>
   

    <gazebo>
        <plugin name="joint_state_publisher"
                filename="libgazebo_ros_joint_state_publisher.so">
                 <updateRate>30</updateRate>
           <jointName>wheel_joint,caster_wheel_joint
            </jointName>
        </plugin>
    </gazebo>

    

    <gazebo reference="base_link">
        <material>Gazebo/Blue</material>
    </gazebo>
    <gazebo reference="caster_wheel">
        <material>Gazebo/Green</material>

    </gazebo>
    <gazebo reference="wheel">
        <material>Gazebo/Red</material>
        <mu>0.01</mu>
        <mu2>0.002</mu2>
    </gazebo>
    <gazebo reference="base_laser">
        <material>Gazebo/Red</material>
    </gazebo>
    <gazebo reference="imu_link">
        <material>Gazebo/Black</material>
    </gazebo>
    <gazebo reference="laser">
        <material>Gazebo/Green</material>
    </gazebo>
    <gazebo reference="camera_link">
        <material>Gazebo/Green</material>
    </gazebo>
    <gazebo reference="right_motor">
       <material>Gazebo/Green</material>
    </gazebo>
    <gazebo reference="left_motor">
        <material>Gazebo/Green</material> 
    </gazebo>

</robot>